name: Add packages

on:
  workflow_dispatch:

permissions:
  contents: write  # Necesario para poder hacer push

jobs:
  add-packages:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ”„ Checkout completo del repositorio
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: ðŸ“¥ Descargar y descomprimir Paquetes.fuentes.zip desde Google Drive
        run: |
          pip install gdown
          gdown --id 1VjruFQxS_cxLOSTNCI-6eAWLiLBYSQ14 -O paquetes.zip

          # Extraer en carpeta temporal
          mkdir temp_extract
          unzip -o paquetes.zip -d temp_extract

          # Crear destino
          mkdir -p .github/sources

          # Copiar todo el contenido de temp_extract a .github/sources
          rsync -av temp_extract/ .github/sources/

      - name: ðŸ“‚ Mostrar estructura final
        run: |
          echo "Contenido de .github/sources:"
          ls -R .github/sources

      - name: ðŸ“¤ Commit y push de los paquetes al repo
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add .github/sources
          git commit -m "AÃ±adir paquetes desde workflow" || echo "No hay cambios que commitear"
          git push origin HEAD:${GITHUB_REF#refs/heads/}
