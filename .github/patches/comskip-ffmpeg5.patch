diff --git a/comskip.c b/comskip.c
index 5f1f4b7..b8a1c2d 100644
--- a/comskip.c
+++ b/comskip.c
@@ -1234,9 +1234,21 @@ int some_function_open_video(AVFormatContext *pFormatCtx, int i)
-    fps = av_q2d(pFormatCtx->streams[i]->r_frame_rate);
-    if (pFormatCtx->streams[i]->codec->ticks_per_frame > 1)
-        fps /= pFormatCtx->streams[i]->codec->ticks_per_frame;
+    fps = av_q2d(pFormatCtx->streams[i]->r_frame_rate);
+#if LIBAVCODEC_VERSION_MAJOR >= 59
+    {
+        AVCodecParameters *codecpar = pFormatCtx->streams[i]->codecpar;
+        AVCodecContext *pCodecCtx = avcodec_alloc_context3(NULL);
+        if (avcodec_parameters_to_context(pCodecCtx, codecpar) < 0) {
+            fprintf(stderr, "Error copying codec parameters\n");
+            return -1;
+        }
+        if (pCodecCtx->ticks_per_frame > 1)
+            fps /= pCodecCtx->ticks_per_frame;
+        avcodec_free_context(&pCodecCtx);
+    }
+#else
+    if (pFormatCtx->streams[i]->codec->ticks_per_frame > 1)
+        fps /= pFormatCtx->streams[i]->codec->ticks_per_frame;
+#endif

     if (fps < 1.0)
         fps = 25.0;
