diff --git a/comskip.c b/comskip.c
index 7f3b2f1..c8a9d3e 100644
--- a/comskip.c
+++ b/comskip.c
@@
-    fps = av_q2d(pFormatCtx->streams[i]->r_frame_rate);
-    if (pFormatCtx->streams[i]->codec->ticks_per_frame > 1)
-        fps /= pFormatCtx->streams[i]->codec->ticks_per_frame;
+    fps = av_q2d(pFormatCtx->streams[i]->r_frame_rate);
+#if LIBAVCODEC_VERSION_MAJOR >= 59
+    {
+        AVCodecParameters *codecpar = pFormatCtx->streams[i]->codecpar;
+        AVCodecContext *pCodecCtx = avcodec_alloc_context3(NULL);
+        if (avcodec_parameters_to_context(pCodecCtx, codecpar) < 0) {
+            fprintf(stderr, "Error copying codec parameters\n");
+            return -1;
+        }
+        if (pCodecCtx->ticks_per_frame > 1)
+            fps /= pCodecCtx->ticks_per_frame;
+        avcodec_free_context(&pCodecCtx);
+    }
+#else
+    if (pFormatCtx->streams[i]->codec->ticks_per_frame > 1)
+        fps /= pFormatCtx->streams[i]->codec->ticks_per_frame;
+#endif
diff --git a/mpeg2dec.c b/mpeg2dec.c
index 1b2c3d4..e5f6a7b 100644
--- a/mpeg2dec.c
+++ b/mpeg2dec.c
@@
-    if (avctx->ticks_per_frame > 1)
-        frame_delay /= avctx->ticks_per_frame;
+#if LIBAVCODEC_VERSION_MAJOR >= 59
+    {
+        double tpf_val = av_q2d(avctx->framerate);
+        if (tpf_val > 1.0)
+            frame_delay /= tpf_val;
+    }
+#else
+    if (avctx->ticks_per_frame > 1)
+        frame_delay /= avctx->ticks_per_frame;
+#endif
@@
-    int got_picture;
-    avcodec_decode_video2(avctx, picture, &got_picture, &pkt);
-    if (got_picture) {
-        // procesamiento de frame
-    }
+    if (avcodec_send_packet(avctx, &pkt) == 0) {
+        while (avcodec_receive_frame(avctx, picture) == 0) {
+            // procesamiento de frame
+        }
+    }
@@
-    av_free_packet(&pkt);
+    av_packet_unref(&pkt);

